# ä½æ‰€â†’éƒµä¾¿ç•ªå·æ¤œç´¢ã®å®Ÿè£…ã‚¬ã‚¤ãƒ‰ ğŸ—ºï¸

## ğŸ“Š å®Ÿè£…æ¸ˆã¿ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

### 1. ğŸ—ƒï¸ ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ï¼ˆè»½é‡ç‰ˆï¼‰
**ç¾åœ¨ã®å®Ÿè£…:** `postal_data.py` ã® `_search_sample_data`
- **å¯¾å¿œåœ°åŸŸ:** æ±äº¬éƒ½ã€å¤§é˜ªåºœã€ç¥å¥ˆå·çœŒã®ä¸»è¦åœ°åŸŸ
- **ãƒ¡ãƒªãƒƒãƒˆ:** é«˜é€Ÿã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸è¦
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:** é™å®šçš„ãªåœ°åŸŸã®ã¿

### 2. ğŸŒ HeartRails Geo APIï¼ˆç„¡æ–™APIï¼‰
**ç¾åœ¨ã®å®Ÿè£…:** `postal_data.py` ã® `_search_with_heartrails_api`
- **å¯¾å¿œåœ°åŸŸ:** å…¨å›½
- **ãƒ¡ãƒªãƒƒãƒˆ:** ç„¡æ–™ã€å…¨å›½å¯¾å¿œã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ä¸è¦
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:** ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆå¿…é ˆã€APIåˆ¶é™ã‚ã‚Š

### 3. ğŸ—„ï¸ ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆé«˜é€Ÿãƒ»å®Œå…¨ç‰ˆï¼‰
**ç¾åœ¨ã®å®Ÿè£…:** `postal_database.py`
- **å¯¾å¿œåœ°åŸŸ:** å…¨å›½ï¼ˆæ—¥æœ¬éƒµä¾¿å…¬å¼ãƒ‡ãƒ¼ã‚¿ï¼‰
- **ãƒ¡ãƒªãƒƒãƒˆ:** é«˜é€Ÿã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã€å®Œå…¨å¯¾å¿œ
- **ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ:** åˆå›ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å¿…è¦ï¼ˆç´„20MBï¼‰

## ğŸš€ é‹ç”¨ãƒ¬ãƒ™ãƒ«ã§ã®æ¨å¥¨å®Ÿè£…

### A. ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ãƒ»å€‹äººåˆ©ç”¨
```python
# HeartRails API + ã‚­ãƒ£ãƒƒã‚·ãƒ¥
def search_address_startup(address):
    # 1. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‹ã‚‰æ¤œç´¢
    # 2. APIå‘¼ã³å‡ºã—
    # 3. çµæœã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥
    pass
```

### B. ä¸­è¦æ¨¡ã‚µãƒ¼ãƒ“ã‚¹
```python
# ãƒ­ãƒ¼ã‚«ãƒ«DB + API ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
def search_address_medium(address):
    # 1. ãƒ­ãƒ¼ã‚«ãƒ«DBã§æ¤œç´¢
    # 2. è¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯API
    # 3. APIçµæœã‚’DBã«ä¿å­˜
    pass
```

### C. å¤§è¦æ¨¡ã‚µãƒ¼ãƒ“ã‚¹
```python
# å°‚ç”¨DB + å®šæœŸæ›´æ–°
def search_address_enterprise(address):
    # 1. PostgreSQL/MySQL
    # 2. å…¨æ–‡æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
    # 3. å®šæœŸçš„ãªãƒ‡ãƒ¼ã‚¿æ›´æ–°
    # 4. å†—é•·åŒ–ãƒ»è² è·åˆ†æ•£
    pass
```

## ğŸ’° ã‚³ã‚¹ãƒˆæ¯”è¼ƒ

| æ–¹å¼ | åˆæœŸã‚³ã‚¹ãƒˆ | é‹ç”¨ã‚³ã‚¹ãƒˆ | ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£ |
|------|------------|------------|------------------|
| ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ | ç„¡æ–™ | ç„¡æ–™ | ä½ |
| HeartRails API | ç„¡æ–™ | ç„¡æ–™ | ä¸­ |
| ãƒ­ãƒ¼ã‚«ãƒ«DB | ç„¡æ–™ | ä½ | é«˜ |
| Google Maps API | ç„¡æ–™æ ã‚ã‚Š | å¾“é‡èª²é‡‘ | é«˜ |
| å°‚ç”¨DBæ§‹ç¯‰ | ä¸­ã€œé«˜ | ä¸­ | æœ€é«˜ |

## ğŸ”§ å®Ÿè£…æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: ç¾åœ¨ã®ã‚¢ãƒ—ãƒªã§è©¦ã™
1. ã€Œâš™ï¸è¨­å®šã€ãƒšãƒ¼ã‚¸ã§ãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã‚’é¸æŠ
2. å„æ–¹å¼ã®ç‰¹å¾´ã‚’ç¢ºèª
3. ç”¨é€”ã«å¿œã˜ã¦æœ€é©ãªæ–¹å¼ã‚’æ±ºå®š

### ã‚¹ãƒ†ãƒƒãƒ—2: æœ¬æ ¼é‹ç”¨ã¸ã®ç§»è¡Œ

#### 2-1. HeartRails APIé‹ç”¨
```python
# ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
import time
from functools import wraps

def rate_limit(calls_per_second=1):
    def decorator(func):
        last_called = [0.0]
        @wraps(func)
        def wrapper(*args, **kwargs):
            elapsed = time.time() - last_called[0]
            left_to_wait = 1.0 / calls_per_second - elapsed
            if left_to_wait > 0:
                time.sleep(left_to_wait)
            ret = func(*args, **kwargs)
            last_called[0] = time.time()
            return ret
        return wrapper
    return decorator
```

#### 2-2. å°‚ç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ§‹ç¯‰
```sql
-- PostgreSQL ãƒ†ãƒ¼ãƒ–ãƒ«è¨­è¨ˆä¾‹
CREATE TABLE postal_addresses (
    id SERIAL PRIMARY KEY,
    postal_code VARCHAR(8) NOT NULL,
    prefecture VARCHAR(20) NOT NULL,
    city VARCHAR(50) NOT NULL,
    town VARCHAR(100),
    full_address TEXT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- å…¨æ–‡æ¤œç´¢ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
CREATE INDEX idx_full_address_gin ON postal_addresses 
USING gin(to_tsvector('japanese', full_address));
```

#### 2-3. å•†ç”¨APIã®åˆ©ç”¨
```python
# Google Maps Geocoding APIä¾‹
import googlemaps

def search_with_google_maps(address, api_key):
    gmaps = googlemaps.Client(key=api_key)
    geocode_result = gmaps.geocode(address)
    # çµæœã®å‡¦ç†
    return process_google_results(geocode_result)
```

## ğŸ† æ¨å¥¨æ§‹æˆ

### æ®µéšçš„ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰æˆ¦ç•¥

1. **ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—æ®µéš**
   - ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨
   - æ©Ÿèƒ½æ¤œè¨¼ã«é›†ä¸­

2. **MVPæ®µéš**
   - HeartRails APIå°å…¥
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†

3. **æˆé•·æ®µéš**
   - ãƒ­ãƒ¼ã‚«ãƒ«DBæ§‹ç¯‰
   - ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

4. **ã‚¹ã‚±ãƒ¼ãƒ«æ®µéš**
   - å°‚ç”¨ã‚¤ãƒ³ãƒ•ãƒ©æ§‹ç¯‰
   - é«˜å¯ç”¨æ€§å¯¾å¿œ

## ğŸ“ˆ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›®æ¨™

| æ®µéš | å¿œç­”æ™‚é–“ç›®æ¨™ | å¯¾å¿œä»¶æ•°/æ—¥ |
|------|--------------|-------------|
| ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ— | <2ç§’ | ã€œ100ä»¶ |
| MVP | <1ç§’ | ã€œ1,000ä»¶ |
| æˆé•·æœŸ | <500ms | ã€œ10,000ä»¶ |
| ã‚¹ã‚±ãƒ¼ãƒ«æœŸ | <200ms | 100,000ä»¶+ |
